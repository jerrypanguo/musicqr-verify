# ä¹è°±éªŒè¯ç³»ç»Ÿ - ä½¿ç”¨è¯´æ˜Ž

## ðŸŽ¯ ç³»ç»Ÿæ¦‚è¿°

ä¹è°±äºŒç»´ç éªŒè¯ç³»ç»ŸVPSç‰ˆæœ¬æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ­£ç‰ˆä¹è°±éªŒè¯è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«æœ¬åœ°å®¢æˆ·ç«¯ã€VPSæœåŠ¡å™¨å’ŒWebç®¡ç†ç•Œé¢ã€‚

## ðŸ‘¥ ç”¨æˆ·è§’è‰²

### 1. ðŸŽµ ä¹è°±åˆ¶ä½œè€…ï¼ˆå®¢æˆ·ç«¯ç”¨æˆ·ï¼‰
- ä½¿ç”¨æœ¬åœ°Pythonå®¢æˆ·ç«¯ç”Ÿæˆå¸¦äºŒç»´ç çš„ä¹è°±PDF
- ç®¡ç†æŽˆæƒç å’ŒäºŒç»´ç ç”Ÿæˆ

### 2. ðŸŽ¼ ä¹è°±è´­ä¹°è€…ï¼ˆæœ€ç»ˆç”¨æˆ·ï¼‰
- æ‰«æäºŒç»´ç éªŒè¯ä¹è°±çœŸä¼ª
- é€šè¿‡Webé¡µé¢æŸ¥çœ‹éªŒè¯ç»“æžœ

### 3. ðŸ› ï¸ ç³»ç»Ÿç®¡ç†å‘˜
- é€šè¿‡Webç®¡ç†åŽå°ç®¡ç†ç³»ç»Ÿ
- ç›‘æŽ§ç³»ç»ŸçŠ¶æ€å’Œæ•°æ®ç»Ÿè®¡

## ðŸ“± å®¢æˆ·ç«¯ä½¿ç”¨æŒ‡å—

### å®‰è£…å’Œé…ç½®

#### 1. çŽ¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿Python 3.8+å·²å®‰è£…
python3 --version

# å®‰è£…ä¾èµ–
cd ä¹è°±éªŒè¯ç³»ç»Ÿ-VPSç‰ˆ/client
pip install -r requirements.txt
```

#### 2. é…ç½®VPSè¿žæŽ¥

```bash
# è®¾ç½®çŽ¯å¢ƒå˜é‡
export VPS_URL='https://verify.yuzeguitar.me'
export CLIENT_SECRET_KEY='your-secret-key-from-server'
export API_KEY_SALT='musicqr_api_salt_2024'

# æˆ–åˆ›å»ºé…ç½®æ–‡ä»¶
cat > config.py << EOF
VPS_URL = 'https://verify.yuzeguitar.me'
CLIENT_SECRET_KEY = 'your-secret-key-from-server'
API_KEY_SALT = 'musicqr_api_salt_2024'
EOF
```

### åŸºæœ¬ä½¿ç”¨

#### 1. ç”Ÿæˆå•ä¸ªäºŒç»´ç 

```bash
# åŸºæœ¬ç”¨æ³•
python3 generate_codes.py

# æŒ‡å®šæŽˆæƒç 
python3 generate_codes.py --code ABCD12345678

# é€‰æ‹©å¸ƒå±€
python3 generate_codes.py --layout horizontal  # æ¨ªç‰ˆ
python3 generate_codes.py --layout vertical    # ç«–ç‰ˆ
```

#### 2. æ‰¹é‡ç”Ÿæˆ

```bash
# ç”Ÿæˆ10ä¸ªæŽˆæƒç 
python3 generate_codes.py --batch 10

# ç”Ÿæˆ100ä¸ªæŽˆæƒç ï¼ˆæ¨ªç‰ˆï¼‰
python3 generate_codes.py --batch 100 --layout horizontal
```

#### 3. ä»Žæ–‡ä»¶å¯¼å…¥

```bash
# ä»Žæ–‡æœ¬æ–‡ä»¶å¯¼å…¥æŽˆæƒç 
python3 generate_codes.py --import codes.txt

# æ–‡ä»¶æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªæŽˆæƒç ï¼‰ï¼š
# ABCD12345678
# EFGH87654321
# IJKL13579246
```

### é«˜çº§åŠŸèƒ½

#### 1. è‡ªå®šä¹‰è®¾ç½®

```python
# åœ¨generate_codes.pyä¸­ä¿®æ”¹
TITLE_TEXT = "æ‚¨çš„ä¹è°±æ ‡é¢˜"
SUBTITLE_TEXT = "ä½œè€…ä¿¡æ¯"
FOOTER_TEXT = "ç‰ˆæƒä¿¡æ¯"
```

#### 2. å­—ä½“é…ç½®

```bash
# å°†å­—ä½“æ–‡ä»¶æ”¾å…¥fontsç›®å½•
cp "Your Font.ttf" client/fonts/

# åœ¨ä»£ç ä¸­æŒ‡å®šå­—ä½“
FONT_PATH = "fonts/Your Font.ttf"
```

#### 3. è¾“å‡ºè®¾ç½®

```python
# ä¿®æ”¹è¾“å‡ºç›®å½•
OUTPUT_DIR = "output"

# ä¿®æ”¹æ–‡ä»¶åæ ¼å¼
filename = f"qr_code_{code}_{timestamp}.pdf"
```

## ðŸŒ Webç•Œé¢ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·éªŒè¯é¡µé¢

#### è®¿é—®åœ°å€
```
https://verify.yuzeguitar.me/
```

#### ä½¿ç”¨æ­¥éª¤
1. **æ‰«æäºŒç»´ç **ï¼šä½¿ç”¨æ‰‹æœºæ‰«æä¹è°±ä¸Šçš„äºŒç»´ç 
2. **è‡ªåŠ¨è·³è½¬**ï¼šæµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€éªŒè¯é¡µé¢
3. **æŸ¥çœ‹ç»“æžœ**ï¼šé¡µé¢æ˜¾ç¤ºéªŒè¯ç»“æžœå’Œä¹è°±ä¿¡æ¯
4. **æ‰‹åŠ¨è¾“å…¥**ï¼šä¹Ÿå¯æ‰‹åŠ¨è¾“å…¥12ä½æŽˆæƒç éªŒè¯

#### éªŒè¯ç»“æžœè¯´æ˜Ž
- âœ… **æ­£ç‰ˆä¹è°±**ï¼šæ˜¾ç¤ºç»¿è‰²ï¼ŒæŽˆæƒç æœ‰æ•ˆ
- âŒ **æ— æ•ˆæŽˆæƒç **ï¼šæ˜¾ç¤ºçº¢è‰²ï¼ŒæŽˆæƒç ä¸å­˜åœ¨æˆ–å·²å¤±æ•ˆ
- âš ï¸ **ç½‘ç»œé”™è¯¯**ï¼šæ˜¾ç¤ºé»„è‰²ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥

### ç®¡ç†åŽå°ä½¿ç”¨

#### è®¿é—®åœ°å€
```
https://verify.yuzeguitar.me/admin
```

#### ç™»å½•ä¿¡æ¯
- **ç”¨æˆ·å**ï¼šadmin
- **å¯†ç **ï¼šéƒ¨ç½²æ—¶ç”Ÿæˆçš„å¯†ç ï¼ˆæŸ¥çœ‹æœåŠ¡å™¨.envæ–‡ä»¶ï¼‰

#### ä¸»è¦åŠŸèƒ½

##### 1. ðŸ“Š ä»ªè¡¨æ¿
- **ç³»ç»Ÿç»Ÿè®¡**ï¼šæ€»æŽˆæƒç æ•°ã€æ¿€æ´»çŽ‡ã€ä»Šæ—¥æŸ¥è¯¢
- **è¶‹åŠ¿å›¾è¡¨**ï¼š7å¤©æ¿€æ´»è¶‹åŠ¿å¯è§†åŒ–
- **æœ€è¿‘æ´»åŠ¨**ï¼šæœ€æ–°æ¿€æ´»çš„æŽˆæƒç åˆ—è¡¨
- **ç³»ç»ŸçŠ¶æ€**ï¼šæœåŠ¡è¿è¡ŒçŠ¶æ€å’Œèµ„æºä½¿ç”¨

##### 2. ðŸ”‘ æŽˆæƒç ç®¡ç†
- **åˆ—è¡¨æŸ¥çœ‹**ï¼šåˆ†é¡µæ˜¾ç¤ºæ‰€æœ‰æŽˆæƒç 
- **æœç´¢åŠŸèƒ½**ï¼šæŒ‰æŽˆæƒç æœç´¢
- **çŠ¶æ€ç­›é€‰**ï¼šç­›é€‰å·²æ¿€æ´»/æœªæ¿€æ´»
- **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡åˆ é™¤ã€å¯¼å‡º
- **è¯¦æƒ…æŸ¥çœ‹**ï¼šæŸ¥çœ‹å•ä¸ªæŽˆæƒç å®Œæ•´ä¿¡æ¯

##### 3. âž• æ·»åŠ æŽˆæƒç 
- **å•ä¸ªæ·»åŠ **ï¼šæ‰‹åŠ¨è¾“å…¥æˆ–è‡ªåŠ¨ç”Ÿæˆ
- **æ‰¹é‡ç”Ÿæˆ**ï¼šä¸€æ¬¡ç”Ÿæˆå¤šä¸ªæŽˆæƒç 
- **æ–‡ä»¶å¯¼å…¥**ï¼šä»ŽCSVæˆ–æ–‡æœ¬æ–‡ä»¶å¯¼å…¥
- **é‡å¤æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹é‡å¤æŽˆæƒç 

##### 4. ðŸ“Š æ•°æ®å¯¼å‡º
- **CSVæ ¼å¼**ï¼šå¯¼å‡ºä¸ºExcelå¯è¯»æ ¼å¼
- **é€‰æ‹©æ€§å¯¼å‡º**ï¼šå¯¼å‡ºæŒ‡å®šæŽˆæƒç 
- **å®Œæ•´ä¿¡æ¯**ï¼šåŒ…å«æ‰€æœ‰å­—æ®µæ•°æ®

##### 5. âš™ï¸ ç³»ç»Ÿä¿¡æ¯
- **æœåŠ¡å™¨çŠ¶æ€**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨
- **æ•°æ®åº“ä¿¡æ¯**ï¼šæ–‡ä»¶å¤§å°ã€è®°å½•æ•°é‡
- **åº”ç”¨ä¿¡æ¯**ï¼šç‰ˆæœ¬ã€é…ç½®ã€å®‰å…¨è®¾ç½®
- **ç»´æŠ¤å·¥å…·**ï¼šç³»ç»Ÿæ£€æŸ¥ã€æ—¥å¿—æŸ¥çœ‹

## ðŸ”§ ç®¡ç†å‘˜æ“ä½œæŒ‡å—

### æ—¥å¸¸ç»´æŠ¤

#### 1. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status musicqr-api nginx

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h

# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u musicqr-api -f
tail -f /var/log/nginx/musicqr_access.log
```

#### 2. æ•°æ®å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½
/var/www/musicqr/backup.sh

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la /var/backups/musicqr/

# æ¢å¤å¤‡ä»½
cp /var/backups/musicqr/backup_20240101.db /var/lib/musicqr/musicqr.db
sudo systemctl restart musicqr-api
```

#### 3. æ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°åº”ç”¨ä»£ç 
cd /home/musicqr/ä¹è°±éªŒè¯ç³»ç»Ÿ-VPSç‰ˆ
git pull  # å¦‚æžœä½¿ç”¨git

# è¿è¡Œæ›´æ–°è„šæœ¬
./server/deploy/update.sh

# é‡å¯æœåŠ¡
sudo systemctl restart musicqr-api nginx
```

### é…ç½®ç®¡ç†

#### 1. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /var/www/musicqr/.env

# ä¿®æ”¹å¯†ç 
ADMIN_PASSWORD=new_secure_password

# é‡å¯æœåŠ¡
sudo systemctl restart musicqr-api
```

#### 2. é…ç½®SSLè¯ä¹¦

```bash
# ç”³è¯·Let's Encryptè¯ä¹¦
sudo certbot --nginx -d verify.yuzeguitar.me

# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

#### 3. æ€§èƒ½ä¼˜åŒ–

```bash
# è°ƒæ•´Nginxé…ç½®
sudo nano /etc/nginx/sites-available/musicqr

# è°ƒæ•´åº”ç”¨é…ç½®
sudo nano /etc/systemd/system/musicqr-api.service

# é‡å¯æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl restart musicqr-api nginx
```

## ðŸ“Š æ•°æ®ç»Ÿè®¡å’Œåˆ†æž

### é€šè¿‡ç®¡ç†åŽå°æŸ¥çœ‹

1. **ç™»å½•ç®¡ç†åŽå°**
2. **è®¿é—®ä»ªè¡¨æ¿**ï¼šæŸ¥çœ‹å®žæ—¶ç»Ÿè®¡
3. **å¯¼å‡ºæ•°æ®**ï¼šä¸‹è½½CSVæ–‡ä»¶è¿›è¡Œåˆ†æž
4. **æŸ¥çœ‹è¶‹åŠ¿**ï¼šè§‚å¯Ÿæ¿€æ´»è¶‹åŠ¿å›¾è¡¨

### é€šè¿‡æ•°æ®åº“æŸ¥è¯¢

```sql
-- è¿žæŽ¥æ•°æ®åº“
sqlite3 /var/lib/musicqr/musicqr.db

-- æŸ¥çœ‹æ€»ä½“ç»Ÿè®¡
SELECT 
    COUNT(*) as total_codes,
    COUNT(CASE WHEN activated = 1 THEN 1 END) as activated_codes,
    ROUND(COUNT(CASE WHEN activated = 1 THEN 1 END) * 100.0 / COUNT(*), 2) as activation_rate
FROM auth_codes;

-- æŸ¥çœ‹æ¯æ—¥æ¿€æ´»ç»Ÿè®¡
SELECT 
    DATE(activation_date) as date,
    COUNT(*) as activations
FROM auth_codes 
WHERE activated = 1 
GROUP BY DATE(activation_date)
ORDER BY date DESC;

-- æŸ¥çœ‹æœ€æ´»è·ƒçš„æŽˆæƒç 
SELECT code, query_count, activation_date, last_query_date
FROM auth_codes 
WHERE activated = 1 
ORDER BY query_count DESC 
LIMIT 10;
```

## ðŸ› å¸¸è§é—®é¢˜è§£å†³

### å®¢æˆ·ç«¯é—®é¢˜

#### 1. æ— æ³•è¿žæŽ¥VPS
```bash
# æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
ping verify.yuzeguitar.me

# æ£€æŸ¥APIå¯†é’¥
echo $CLIENT_SECRET_KEY

# æµ‹è¯•APIæŽ¥å£
curl https://verify.yuzeguitar.me/api/status
```

#### 2. å­—ä½“æ˜¾ç¤ºé—®é¢˜
```bash
# æ£€æŸ¥å­—ä½“æ–‡ä»¶
ls -la client/fonts/

# ä½¿ç”¨ç³»ç»Ÿå­—ä½“
# ä¿®æ”¹generate_codes.pyä¸­çš„FONT_PATH
```

#### 3. PDFç”Ÿæˆå¤±è´¥
```bash
# æ£€æŸ¥ä¾èµ–
pip install --upgrade reportlab qrcode pillow

# æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™
chmod 755 client/output/
```

### æœåŠ¡å™¨é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u musicqr-api -n 50

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /var/www/musicqr/.env

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :5000
```

#### 2. æ•°æ®åº“é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la /var/lib/musicqr/musicqr.db

# æ£€æŸ¥æƒé™
sudo chown musicqr:musicqr /var/lib/musicqr/musicqr.db

# é‡æ–°åˆå§‹åŒ–
cd /var/www/musicqr
source venv/bin/activate
python3 -c "from models import init_db; init_db('/var/lib/musicqr/musicqr.db')"
```

#### 3. Nginxé…ç½®é—®é¢˜
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **å¼€å‘è€…**ï¼šYuze Pan
- **å¾®ä¿¡**ï¼šGuitar_yuze
- **ç‰ˆæœ¬**ï¼šv2.0.0

### èŽ·å–å¸®åŠ©
1. **æŸ¥çœ‹æ—¥å¿—**ï¼šé¦–å…ˆæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
2. **è¿è¡Œæµ‹è¯•**ï¼šä½¿ç”¨test_system.pyè¯Šæ–­é—®é¢˜
3. **æŸ¥çœ‹æ–‡æ¡£**ï¼šå‚è€ƒéƒ¨ç½²æŒ‡å—å’Œæ•…éšœæŽ’é™¤
4. **è”ç³»æ”¯æŒ**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼è®©æ­£ç‰ˆä¹è°±éªŒè¯å˜å¾—ç®€å•è€Œä¼˜é›…** ðŸŽµ
