{% extends "base.html" %}

{% block title %}ç®¡ç†ä»ªè¡¨æ¿ - ä¹è°±éªŒè¯ç³»ç»Ÿ{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; font-weight: 300;">ğŸ“Š ç³»ç»Ÿä»ªè¡¨æ¿</h1>

<!-- ç»Ÿè®¡å¡ç‰‡ -->
<div class="stats-grid">
    <div class="stat-card">
        <span class="stat-number">{{ stats.total_codes or 0 }}</span>
        <div class="stat-label">æ€»æˆæƒç æ•°</div>
    </div>
    <div class="stat-card">
        <span class="stat-number">{{ stats.activated_codes or 0 }}</span>
        <div class="stat-label">å·²æ¿€æ´»</div>
    </div>
    <div class="stat-card">
        <span class="stat-number">{{ "%.1f"|format(stats.activation_rate or 0) }}%</span>
        <div class="stat-label">æ¿€æ´»ç‡</div>
    </div>
    <div class="stat-card">
        <span class="stat-number">{{ stats.today_queries or 0 }}</span>
        <div class="stat-label">ä»Šæ—¥æŸ¥è¯¢</div>
    </div>
</div>

<!-- å¿«é€Ÿæ“ä½œ -->
<div class="card">
    <h2>ğŸš€ å¿«é€Ÿæ“ä½œ</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('admin_codes') }}" class="btn btn-primary">ç®¡ç†æˆæƒç </a>
        <a href="{{ url_for('admin_add_code') }}" class="btn">æ·»åŠ æˆæƒç </a>
        <a href="{{ url_for('admin_export') }}" class="btn">å¯¼å‡ºæ•°æ®</a>
        <a href="{{ url_for('admin_system_info') }}" class="btn">ç³»ç»Ÿä¿¡æ¯</a>
    </div>
</div>

<!-- æœ€è¿‘æ¿€æ´» -->
{% if recent_activations %}
<div class="card">
    <h2>ğŸ“ˆ æœ€è¿‘æ¿€æ´»</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æˆæƒç </th>
                    <th>æ¿€æ´»æ—¶é—´</th>
                    <th>æŸ¥è¯¢æ¬¡æ•°</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for activation in recent_activations %}
                <tr>
                    <td><code>{{ activation.code }}</code></td>
                    <td>{{ activation.activation_date[:19] if activation.activation_date else '-' }}</td>
                    <td>{{ activation.query_count or 0 }}</td>
                    <td>
                        <a href="{{ url_for('admin_code_detail', code=activation.code) }}" 
                           class="btn btn-small">è¯¦æƒ…</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- ç³»ç»ŸçŠ¶æ€ -->
<div class="card">
    <h2>âš™ï¸ ç³»ç»ŸçŠ¶æ€</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div>
            <strong>æœåŠ¡çŠ¶æ€:</strong> 
            <span style="color: #007700;">â— è¿è¡Œä¸­</span>
        </div>
        <div>
            <strong>æ•°æ®åº“å¤§å°:</strong> 
            {{ "%.2f"|format(db_size_mb or 0) }} MB
        </div>
        <div>
            <strong>æœåŠ¡å™¨æ—¶é—´:</strong> 
            {{ current_time }}
        </div>
        <div>
            <strong>APIç‰ˆæœ¬:</strong> 
            v2.0.0
        </div>
    </div>
</div>

<!-- ä½¿ç”¨è¶‹åŠ¿å›¾ -->
{% if daily_stats %}
<div class="card">
    <h2>ğŸ“Š 7å¤©æ¿€æ´»è¶‹åŠ¿</h2>
    <div style="height: 200px; display: flex; align-items: end; gap: 10px; padding: 20px 0;">
        {% for day in daily_stats %}
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
            <div style="background: #000000; width: 100%; height: {{ (day.count / max_daily_count * 150) if max_daily_count > 0 else 0 }}px; min-height: 2px;"></div>
            <div style="margin-top: 10px; font-size: 0.8em; text-align: center;">
                <div>{{ day.count }}</div>
                <div style="color: #666;">{{ day.date[-5:] }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- æ“ä½œæ—¥å¿— -->
<div class="card">
    <h2>ğŸ“ æ“ä½œæç¤º</h2>
    <div style="color: #666666; line-height: 1.8;">
        <p>â€¢ ç‚¹å‡»"ç®¡ç†æˆæƒç "æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰æˆæƒç </p>
        <p>â€¢ ä½¿ç”¨"æ·»åŠ æˆæƒç "æ‰‹åŠ¨æ·»åŠ æ–°çš„éªŒè¯ç </p>
        <p>â€¢ "å¯¼å‡ºæ•°æ®"å¯ä»¥ä¸‹è½½æ‰€æœ‰æˆæƒç çš„CSVæ–‡ä»¶</p>
        <p>â€¢ ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰éªŒè¯å’Œæ¿€æ´»æ“ä½œ</p>
        <p>â€¢ å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// è‡ªåŠ¨åˆ·æ–°ç»Ÿè®¡æ•°æ®
setInterval(function() {
    // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡é¡µé¢æ•°æ®ï¼ˆå¯é€‰ï¼‰
    // location.reload();
}, 30000);

// æ˜¾ç¤ºå½“å‰æ—¶é—´
function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleString('zh-CN');
    // å¯ä»¥æ›´æ–°é¡µé¢ä¸Šçš„æ—¶é—´æ˜¾ç¤º
}

setInterval(updateTime, 1000);
</script>
{% endblock %}
